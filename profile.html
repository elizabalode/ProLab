<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profile</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body{font-family:"Inter",system-ui,Arial;max-width:900px;margin:24px auto;padding:0 16px;
      background:linear-gradient(135deg,#e9c2eb,#81aeec);min-height:100vh;}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input,select,button{padding:10px;font-size:14px;font-family:"Inter",system-ui,Arial}
    .card{border:1px solid #ddd;border-radius:12px;padding:14px;margin-top:14px;background:rgba(223,144,144,0.534)}
    .nav{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .muted{opacity:.85}
    a{color:#111;text-decoration:underline}
  </style>
</head>
<body>

<div class="card nav">
  <div><b>Balansētas ēdienkartes plānotājs</b> <span class="muted">/ profile</span></div>
  <div class="row">
    <a href="/login">Login</a>
    <a href="/profile-page">Profile</a>
    <a href="/planner">Planner</a>
    <button id="logoutBtn">Izlogoties</button>
  </div>
</div>

<div class="card">
  <h2>Profils</h2>
  <div class="row">
    <input id="name" placeholder="Vārds" />
    <input id="weight" placeholder="Svars (kg)" type="number" step="0.1" />
    <input id="height" placeholder="Augums (cm)" type="number" step="0.1" />
    <input id="age" placeholder="Vecums" type="number" value="25" />
  </div>

  <div class="row">
    <select id="sex">
      <option value="M">Vīrietis</option>
      <option value="F">Sieviete</option>
    </select>

    <select id="activity">
      <option value="1.2">Mazkustīgs (1.2)</option>
      <option value="1.375">Viegls (1.375)</option>
      <option value="1.55" selected>Vidējs (1.55)</option>
      <option value="1.725">Aktīvs (1.725)</option>
      <option value="1.9">Ļoti aktīvs (1.9)</option>
    </select>

    <input id="target" placeholder="Manuāls mērķis (kcal) — var tukšs" type="number" />
    <button id="loadProfile">Ielādēt</button>
    <button id="saveProfile">Saglabāt</button>
  </div>

  <p>Statuss: <span id="status">—</span></p>
</div>

<div class="card">
  <h2>Tālāk</h2>
  <p class="muted">Kad profils saglabāts, vari ģenerēt plānu un skatīt vēsturi.</p>
  <button onclick="window.location.href='/planner'">Uz ēdienplānu →</button>
</div>

<script>
async function loadProfile(){
  const res = await fetch("/api/profile");
  const data = await res.json().catch(()=>({}));
  if(res.status === 401) { window.location.href="/login"; return; }
  if(!res.ok) return alert("Profile error: " + (data.error || res.status));

  if(!data.has_profile){
    document.getElementById("status").textContent = "Nav profila — aizpildi un saglabā.";
    return;
  }

  document.getElementById("name").value = data.name ?? "";
  document.getElementById("weight").value = data.weight_kg ?? "";
  document.getElementById("height").value = data.height_cm ?? "";
  document.getElementById("age").value = data.age ?? 25;
  document.getElementById("sex").value = data.sex ?? "F";
  document.getElementById("activity").value = String(data.activity ?? "1.55");
  document.getElementById("target").value = data.target_kcal ?? "";

  document.getElementById("status").textContent = "Profils ielādēts ✅";
}

async function saveProfile(){
  const payload = {
    name: document.getElementById("name").value,
    weight_kg: document.getElementById("weight").value,
    height_cm: document.getElementById("height").value,
    age: document.getElementById("age").value,
    sex: document.getElementById("sex").value,
    activity: document.getElementById("activity").value,
    target_kcal: document.getElementById("target").value
  };

  const res = await fetch("/api/profile", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  const data = await res.json().catch(()=>({}));
  if(res.status === 401) { window.location.href="/login"; return; }
  if(!res.ok) return alert("Saglabāt neizdevās: " + (data.error || res.status));

  document.getElementById("status").textContent = "Saglabāts ✅";
}

document.getElementById("loadProfile").onclick = loadProfile;
document.getElementById("saveProfile").onclick = saveProfile;

document.getElementById("logoutBtn").onclick = async () => {
  await fetch("/api/logout", { method:"POST" });
  window.location.href="/login";
};

loadProfile();
</script>

</body>
</html>
