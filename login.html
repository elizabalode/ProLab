<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body{
      font-family:"Inter",system-ui,Arial;
      max-width:900px; margin:24px auto; padding:0 16px;
      background:linear-gradient(135deg,#e9c2eb,#81aeec);
      min-height:100vh;
    }
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input,button{padding:10px;font-size:14px;font-family:"Inter",system-ui,Arial}
    .card{border:1px solid #ddd;border-radius:12px;padding:14px;margin-top:14px;background:rgba(223,144,144,0.534)}
    .nav{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .muted{opacity:.85}
    a{color:#111;text-decoration:underline}
  </style>
</head>
<body>

<div class="card nav">
  <div><b>Balanced Meal Planner</b> <span class="muted">/ login</span></div>
  <div class="row">
    <a href="/login">Login</a>
    <a href="/profile-page">Profile</a>
    <a href="/planner">Planner</a>
  </div>
</div>

<div class="card">
  <h2>Autorizācija</h2>
  <div class="row">
    <input id="email" placeholder="Email" />
    <input id="password" placeholder="Parole" type="password" />
    <button id="registerBtn">Reģistrēties</button>
    <button id="loginBtn">Ielogoties</button>
    <button id="logoutBtn">Izlogoties</button>
  </div>
  <p>Statuss: <span id="authState">—</span></p>
  <p class="muted" id="hint"></p>
</div>

<script>
async function refreshAuth(){
  const res = await fetch("/api/me");
  const data = await res.json().catch(()=>({}));
  const logged = !!data.logged_in;
  document.getElementById("authState").textContent = logged ? "Logged in" : "Logged out";
  document.getElementById("hint").textContent = logged
    ? "Vari doties uz profilu → Profile"
    : "Reģistrējies vai ielogojies.";
}

document.getElementById("registerBtn").onclick = async () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/api/register", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ email, password })
  });

  const data = await res.json().catch(()=>({}));
  if(!res.ok) return alert("Reģistrācija neizdevās: " + (data.error || res.status));
  alert("Reģistrācija OK — tagad ielogojies.");
};

document.getElementById("loginBtn").onclick = async () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/api/login", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ email, password })
  });

  const data = await res.json().catch(()=>({}));
  if(!res.ok) return alert("Login neizdevās: " + (data.error || res.status));

  await refreshAuth();
  // pēc login uz profilu
  window.location.href = "/profile-page";
};

document.getElementById("logoutBtn").onclick = async () => {
  await fetch("/api/logout", { method:"POST" });
  await refreshAuth();
  alert("Logout OK");
};

refreshAuth();
</script>

</body>
</html>
